{extend name="public:base" /}

{block name="style"}

{/block}

{block name="content"}
<table id="demo" lay-filter="test"></table>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        {if condition="$arcrank neq -1"}
        <a href='{:url("article_add")}' class="layui-btn layui-btn-sm layui-btn-normal" lay-event="">[添加文档]</a>
        <a href='{:url("/Admin/CatalogMain")}' class="layui-btn layui-btn-sm" lay-event="">[栏目管理]</a>
        <!--<a href='{:url("makehtml_list",["cid"=>0])}' class="layui-btn layui-btn-xs" lay-event="">[更新列表]</a>-->
        <!--<a href='{:url("makehtml_archives",["cid"=>0])}' class="layui-btn layui-btn-xs" lay-event="">[更新文档]</a>-->
        <a href='{:url("recycling", ["cid"=>0])}' class="layui-btn layui-btn-sm" lay-event="">[文档回收站]</a>
        <a href="javascript:;" class="layui-btn layui-btn-sm layui-btn-danger" lay-event="" onclick="table_delete()">[删除文档]</a>
        {/if}
    </div>
</script>
{/block}


{block name="script"}
<script type="application/javascript">
function table_delete(){
    var arr_box = [];
    $('input[type=checkbox]:checked').each(function(){
        arr_box.push($(this).val());
    });
    var arr = arr_box.join(",")
    $.post("{:url('article_delete')}", {arr:arr}, function(obj){
        if(obj.code == 0){
            layer.msg(obj.msg, function(){
                window.location.href = "{:url('index')}";
            });
        }else{
            layer.msg(obj.msg);
        }
    }, 'json')
}

function getCheckboxItem(){
    var allSel="";
    if(document.form2.arcTitle.value) return document.form2.arcTitle.value;
    for(i=0;i<document.form2.arcTitle.length;i++)
    {
        if(document.form2.arcTitle[i].checked)
        {
            if(allSel=="")
                allSel=document.form2.arcTitle[i].value;
            else
                allSel=allSel+"`"+document.form2.arcTitle[i].value;
        }
    }
    return allSel;
}

//删除文档
function delArc(){
    var qstr = getCheckboxItem();
    document.form2.titles.value = qstr;
    document.form2.submit();
}
layui.use('table', function(){
    var table = layui.table;

    table.on('tool(demoCatalogMain)', function(obj){
        var data = obj.data,
            layEvent = obj.event,
            tr = obj.tr;

        if(layEvent === 'detail'){
            var _url = $(this).attr('data-url');
            window.open(_url);
        }

    });


})

layui.use(['table', 'jquery'], function(){
    var table = layui.table,
        $ = layui.jquery;

    //第一个实例
    table.render({
        elem: '#demo'
        ,url: "{:url('')}"
        ,method: 'post'
        ,request: {}
        ,response: {}
        , toolbar: '#toolbarDemo'
        ,page: true
        ,cols: [[
            {field: 'id', title: 'ID', width:80,fixed: 'left'}
            ,{field: 'title', title: '文章标题', width:180}
            ,{field: 'ctypename', title: '栏目', width:90}
            ,{field: 'click', title: '点击', width:90}
            ,{field: 'ismake', title: '选择', width:90}
            ,{field: 'userid', title: '发布人', width:90}
            ,{field: 'senddate', title: '更新时间', width:170}
            ,{fixed: 'right', width:150, align:'center', toolbar: '#barDemo'}
        ]]
    });

    table.on('tool(test)', function(obj){
        var data = obj.data;
        var layEvent = obj.event;
        var tr = obj.tr;
        if(layEvent === 'del'){
            layer.confirm('真的删除行么', function(index) {
                $.post("{:url('article_del')}", {id:data.id}, function (objs) {
                    if(objs.code == 200) {
                        layer.msg(objs.msg, {icon: 1}, function () {
                            obj.del();
                            layer.close(index);
                        })
                    } else {
                        layer.msg(objs.msg, {icon: 2});
                    }
                }, 'json');
            })
        }else if(layEvent === 'edit'){
            window.location.href = "{:url('article_edit')}?aid=" +data.id;
        }

    })

});

</script>
{/block}