{extend name="public:base" /}

{block name="content"}
<a href="{:url('mychannel_add')}" class="layui-btn layui-btn-xs" lay-event="edit">增加新模型</a>
<!--<table lay-filter="" class="layui-table">
    <thead>
    <tr>
        <th lay-data="{field:'f1'}">频道名称</th>
        <th lay-data="{field:'f2'}">识别ID</th>
        <th lay-data="{field:'f3'}">附加表</th>
        <th lay-data="{field:'f4'}">状态</th>
        <th lay-data="{field:'f5'}">模型</th>
        <th lay-data="{field:'f6'}">管理</th>
    </tr>
    </thead>
    <tbody>
    {volist name="_data" id="vo"}
    <tr>
        <td>{$vo['typename']}</td>
        <td>{$vo['nid']}</td>
        <td>{$vo['addtable']}</td>
        <td>{$vo['isshow']|GetSta=###, $vo['id']|raw}</td>
        <td>{$vo['issystem']|IsSystem}</td>
        <td>
            <a href="{:url('mychannel_edit', ['id'=>$vo['id'],'dopost'=>'edit'])}" class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit">更改</a>
            <a href="{:url('mychannel_delete', ['id'=>$vo['id'],'dopost'=>'delete'])}" class="layui-btn layui-btn-xs layui-btn-danger" lay-event="edit">删除</a>
        </td>

    </tr>
    {/volist}
    </tbody>
</table>-->

<table id="demo" lay-filter="test"></table>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
{/block}

{block name="script"}
<script>
    layui.use(['table', 'jquery'], function(){
        var table = layui.table,
            $ = layui.jquery;

        //第一个实例
        table.render({
            elem: '#demo'
            ,url: "{:url('')}"
            ,method: 'post'
            ,request: {}
            ,response: {}
            ,page: true
            ,cols: [[ //表头
                {field: 'id', title: 'ID', width:80,fixed: 'left'}
                ,{field: 'typename', title: '频道名称', width:180}
                ,{field: 'nid', title: '识别ID', width:180}
                ,{field: 'addtable', title: '附加表:', width:140}
                ,{field: 'isshow', title: '状态', width:80}
                ,{field: 'ischeck', title: '模型', width:90}
                ,{fixed: 'right', width:150, align:'center', toolbar: '#barDemo'}
            ]]
        });

        table.on('tool(test)', function(obj){
            var data = obj.data;
            var layEvent = obj.event;
            var tr = obj.tr;
            if(layEvent === 'del'){
                layer.confirm('真的删除行么', function(index) {
                    $.post("{:url('friendlink_delete')}", {id:data.id}, function (objs) {
                        if(objs.code == 200) {
                            layer.msg(objs.msg, {icon: 1}, function () {
                                obj.del();
                                layer.close(index);
                            })
                        } else {
                            layer.msg(objs.msg, {icon: 2});
                        }
                    }, 'json');
                })
            }else if(layEvent === 'edit'){
                // obj.update({
                //     username: '123'
                //     ,title: 'xxx'
                // });
                window.location.href = "{:url('friendlink_edit')}?id=" +data.id;
            }

        })

    });
</script>
{/block}